<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.
		
		function movePaddle(controller){
			let player1 = this.getNode('player1');
			let player2 = this.getNode('player2');
			let ball = this.getNode('ball');

			if(ball.gamePause)
				return true;
			//If Left Arrow is Clicked then player2 will move in left direction
			if(controller[37].active){
				player2.x = player2.x > 0 ? (player2.x - player2.width/5):player2.x;
			}

			//If Right Arrow is Clicked then player2 will move in right direction
			if(controller[39].active){
				player2.x = player2.x + player2.width < this.width ? (player2.x + player2.width/5) : player2.x;
			}

			//If W is Clicked then player1 will move in left direction
			if(controller[87].active){
				player1.x = player1.x > 0 ? (player1.x - player1.width/5):player1.x;
			}

			//If S is Clicked then player2 will move in Right direction
			if(controller[83].active){
				player1.x = (player1.x + player1.width < this.width) ? (player1.x + player1.width/5) : player1.x;
			}

		}
		function eventTrigger(event,controller,up){

			let ball = this.getNode('ball');
			//If space is clicked then pause the game

			console.log(event.keyCode);
			if(event.keyCode == 32 && !up){
					this.pause();
					return;
			}
			if(event.keyCode == 82 && !up){
					this.reset();
					return;
			}

			if(controller[event.keyCode] && !up){
				controller[event.keyCode].active = true;
			}

			if(controller[event.keyCode] && up){
				controller[event.keyCode].active = false;
			}




			
			
	


			
		}

		function isStriked(ball,player){
			let xCondition = ((ball.x + ball.width >= player.x) && (ball.x <= player.x +player.width));
			let yCondition;
			if(player.top){
				yCondition = ((ball.y >= player.y) && (ball.y <= (player.y + player.height) ));
			}
			else{
				yCondition = (((ball.y + ball.height) >= player.y) && (ball.y <= (player.y +player.height)));
			}
			if(xCondition && yCondition)
				return true;
			return false;
		}

		function delay(ms){

			let t1=new Date().getTime();
			let t2=t1;
			while(t2 < t1 + ms)
			{
				t2=new Date().getTime();
			}

		}
		app.onInit = function(){
			
			
			this.nodes.push({
				id : 'gameScreen',
				x  : 0,
				y  : 0,
				width  : this.width,
				height : this.height,
				color  : 'black',
				direction : 0
			});
			
			this.nodes.push({
				id : 'player1',
				x  : this.width/2-this.width/20,
				y  : 0,
				width  : this.width/10,
				height : this.height/20,
				color  : 'white',
				direction : 0,
				score : 0,
				top : true
			});

			this.nodes.push({
				id : 'player2',
				x  : this.width/2-this.width/20,
				y  : this.height-this.height/6,
				width  : this.width/10,
				height : this.height/20,
				color  : 'white',
				direction : 0,
				score : 0,
				top : false
			});

			this.nodes.push({
				id : 'ball',
				x  : this.width/2,
				y  : (this.height-this.height/6)/2,
				width  : this.width/100,
				height : this.height/100,
				color  : 'red',
				velocityX: this.width/200,
				velocityY: this.height/60,
				gamePause : true,
				shape : 'circle'
			});

			let newId=0;
			let cnt=0;
			while(newId < this.width)
			{
				this.nodes.push({
				id : 'divide'+String(cnt++),
				x  : newId,
				y  : (this.height-this.height/6)/2,
				width  : this.width/30,
				height : this.height/120,
				color  : 'white'
			});

			newId=newId+2*this.width/30;

			}
			let triggeredevent = eventTrigger.bind(this);
			let paddleMover = movePaddle.bind(this);

			let controller = {
			  87: {active: false},
  			  83: {active: false},
              37: {active: false},
              39: {active: false},
             }

			document.addEventListener('keydown', function(event){
				triggeredevent(event,controller,false);
				paddleMover(controller);
			},true);

			document.addEventListener('keyup', function(event){
				triggeredevent(event,controller,true);
				paddleMover(controller);
			},true);


			// Adding Score Functionality
			
			

			this.text.push({
				id : 'player1score',
				x : 0,
				y :this.height/2 - this.height/9,
				color : "red",
				key : "Score:",
				value : this.getNode("player1").score,
				fontSize : "20px",
				font: "Arial"
			});

			this.text.push({
				id : 'player2score',
				x : 0,
				y :this.height/2 -this.height/120 ,
				color : "red",
				key : "Score:",
				value : this.getNode("player2").score,
				fontSize : "20px",
				font: "Arial"
			});


		};

		app.onUpdate = function(time){


			//resizing canvas to window's full width and height
			this.width = window.innerWidth;
			this.height = window.innerHeight;

			//adjusting the properties of gamescreen according to the window size

			this.getNode('gameScreen').width = this.width;
			this.getNode('gameScreen').height = this.height;

			//adjusting the properties of divider according to the window size

			let newId=0;
			let cnt=0
			while(newId < this.width)
			{
			
			this.getNode('divide'+String(cnt)).height = this.height/120;
			this.getNode('divide'+String(cnt)).width = this.width/30;
			this.getNode('divide'+String(cnt)).x = newId;
			this.getNode('divide'+String(cnt)).y = (this.height-this.height/6)/2;
			
			cnt++;

			newId=newId+2*this.width/30;
			
			}

			let player1 = this.getNode('player1');
			let player2 = this.getNode('player2');
			let ball = this.getNode('ball');
			let player1score = this.getText('player1score');
			let player2score = this.getText('player2score');


			//adjusting the properties of player1 according to the window size
			player1.x = ((player1.x * this.width)/(player1.width*10));
			player1.width=this.width/10;
			player1.height=this.height/20;

			//adjusting the properties of player2 according to the window size
			player2.x = ((player2.x * this.width)/(player2.width*10));
			player2.y = this.height-this.height/6;
			player2.width = this.width/10;
			player2.height = this.height/20;

			//adjusting height and width of ball
			ball.x = ((ball.x * this.width)/(ball.width*100));
			ball.y = ((ball.y * this.height)/(ball.height*100));
			ball.width = this.width/100;
			ball.height = this.height/100;

			//adjusting the position of score system and values assigned to it
			player1score.y = this.height/2 - this.height/9;
			player1score.value = this.getNode("player1").score;

			player2score.y = this.height/2 -this.height/120;
			player2score.value = this.getNode("player2").score;


			//implementing the functionality of the game
			if(ball.gamePause != true){
				delay(10);
				ball.x+=ball.velocityX;
				ball.y+=ball.velocityY;

				//Checking whether the ball is hitted by Player or not

				if(isStriked(ball,player1) || isStriked(ball,player2)){
					ball.velocityY=-1*ball.velocityY;
				}


				//Checking for boundary Hitting Condition
				if( ball.x + ball.width >= this.width || ball.x <= 0 ){
					ball.velocityX = -1 * ball.velocityX;
				}
				
				if( ball.y + ball.height >= this.height || ball.y <= 0 ){
					ball.velocityY = -1 * ball.velocityY;
					if(ball.y<=0)
						player2.score++;
					else
						player1.score++;
					console.log("Player 1 Score:",player1.score);
					console.log("Player 2 Score:",player2.score);
				}



			}
		}

		app.reset = function(){
			let player1 = this.getNode('player1');
			let player2 = this.getNode('player2');
			let ball = this.getNode('ball');

			player1.score = 0;	
			player1.x = this.width/2-this.width/20;

			player2.score = 0;	
			player2.x = this.width/2-this.width/20;

			ball.x = this.width/2;
			ball.y = (this.height-this.height/6)/2;
			ball.gamePause = true;
		}

		app.pause = function(){
			let ball = this.getNode('ball');
			ball.gamePause = !ball.gamePause;
			

			
		}

	</script>
</body>
</html>