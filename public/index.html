<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
	<style>
		* {
		  padding: 0;
		  margin: 0;
		}
  
		body {
		  width: 100vw;
		  height: 100vh;
		  display: flex;
		  justify-content: center;
		  align-items: center;
		  background-color: rgb(16, 80, 136);
		}
	  </style>
</head>
<body>
	<canvas id="canvas"  border: 2px solid #FFF;
	position: absolute;
	margin :auto;
	top:0;
	right:0;
	left:0;
	bottom:0;>
    </canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.
  // load sounds
  let hit = new Audio();
  let wall = new Audio();
  let player1audio = new Audio();
  let player2audio = new Audio();

  hit.src = "sounds/hit.mp3";
  wall.src = "sounds/wall.mp3";
  player1audio.src = "sounds/comScore.mp3";
  player2audio.src = "sounds/userScore.mp3";

  // Declaring Ball class

  class Ball {
    constructor(id, x, y) {
        this.id = id;
        this.startX = app.width/2;
        this.startY = app.height/2;
        this.width = 8;
        this.height = 8;
		this.radius = 10;
		this.color = 'white';
        this.resetPosition();

    }

    resetPosition() {
        this.x = this.startX;
        this.y = this.startY;
        this.speed = 3;
        let angle = Math.random() * Math.PI * 2;
        this.velx = 3;
		this.velY =3;
	
    }

    move() {
        this.x += this.velx;
        this.y += this.velY;
    }

    collisionDetect(player, ball) {
      ball.top = ball.y;
      ball.right = ball.x + ball.width;
      ball.bottom = ball.y + ball.height;
      ball.left = ball.x;

      player.top = player.y ;
      player.bottom = player.y + player.height;
      player.left = player.x;
      player.right = player.x + player.width;
        
      return ball.left < player.right && ball.top < player.bottom && ball.right > player.left && ball.bottom > player.top;
    }

   
        
	

    update(time) {
     
        this.x += this.velx;
        this.y += this.velY;

        
        let player = (ball.x + ball.radius < app.width / 2) ? player1 : player2

        if (ball.collisionDetect(player, ball)) {
            let angle = 0;
            hit.play()
           
            if (this.y < (player.y + player.height / 2)) {
                angle = -1 * Math.PI / 4;
            }
           
            else if (this.y > (player.y + player.height / 2)) {
                angle = Math.PI / 4;
            }

			
			let direction = (player === app.getNode('player1') ? 1 : -1)
            this.velx = direction * this.speed * Math.cos(angle);
            this.velY = this.speed * Math.sin(angle);

            this.speed += 0.1;
        }
        if (this.y + this.height >= app.height || this.y <= 0) {
			this.velY = -this.velY;
			wall.play();
        }

	
        if (this.x > app.width) {
            app.getNode('player1').score++;
            score += 1
            console.log('player1 win!!!!', "score: " + player1.score );
		
			player1audio.play();
            app.restartMatch();
        }
      
        else if (this.x + this.width < 0) {
            app.getNode('player2').score++;
            score += 1
            console.log('player2 win!!!!', "score: " + player2.score );
			
			player2audio.play()
            app.restartMatch();
        }
        
    }


}

class Pad {
    constructor(id, x, y, upKey, downKey) {
        this.id = id;
        this.startX = x;
        this.startY = y;
        this.width = paddleWidth;
        this.height = paddleHeight;
        this.color = 'black';
        this.upKey = upKey;
        this.downKey = downKey;
        this.score = 0;
        this.resetPosition();
        this.eventListner();
    }

    resetPosition() {
        this.x = this.startX;
        this.y = this.startY;
        this.up = false;
        this.down = false;
    }

    eventListner() {
        document.addEventListener("keyup", (event) => this.keyboardEvent(event));
        document.addEventListener("keydown", (event) => this.keyboardEvent(event));
        
    }

    keyboardEvent(event) {
        if (event.type === "keydown") {
            if (event.key === this.upKey) {
                this.up = true;
            } else if (event.key === this.downKey) {
                this.down = true;
            }
        } else if (event.type === "keyup") {
            if (event.key === this.upKey) {
                this.up = false;
            } else if (event.key === this.downKey) {
                this.down = false;
            }
        }
    }

    move() {
        
    }

    // barrier() {
    //     let min = 0;
    //     let max = app.height - this.height;
    //     this.y = Math.min(Math.max(this.y, min), max);
    // }

    update(time) {
        // this.move();
        if (this.up) {
            this.y -= moveSpeed;
        }
        if (this.down) {
            this.y += moveSpeed;
        }

         let min = 0;
         let max = app.height - this.height;
         this.y = Math.min(Math.max(this.y, min), max);
        

        // this.barrier();
    }

    // addScore() {
    //     this.score += 1;
    //     console.log(`${this.id} win!!!!  score: ${this.score}`);
    // }

    // getScore() {
    //     return this.score;
    // }
}



  app.onInit = function(){
			
		};

		app.onUpdate = function(time){
			
		};

		
	</script>
</body>
</html>