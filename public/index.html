<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas"></canvas>

	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		const constants = {
			SPEED_MULTIPLIER: 10,
			BALL_SPEED: 5,
			PADDLE_WIDTH: 30,
			PADDLE_HEIGHT: 250,
			MARGIN : 10
		}


		app.onInit = function(){
			this.canvas.height = document.documentElement.clientHeight;
			this.canvas.width = document.documentElement.clientWidth;
			p1 = this.getNode('p1');
			p2 = this.getNode('p2');
			document.addEventListener('keydown', event => {

				if (event.code === 'KeyS')      p1.direction =  1;
				if (event.code === 'KeyW')      p1.direction = -1;
				if (event.code === 'ArrowUp')   p2.direction = -1;
				if (event.code === 'ArrowDown') p2.direction =  1;
				if (event.code === 'Space')     app.togglePause();
			});
			document.addEventListener('keyup', event => {
				if (event.code === 'KeyW')      p1.direction = 0;
				if (event.code === 'KeyS')      p1.direction = 0;
				if (event.code === 'ArrowUp')   p2.direction = 0;
				if (event.code === 'ArrowDown') p2.direction = 0;
			});

			this.nodes.push({
				id     : 'background',
				x      : 0,
				y      : 0,
				width  : this.canvas.width,
				height : this.canvas.height,
				color  : 'black'
				});
			this.nodes.push({
				id     : 'p1',
				x      : constants.MARGIN,
				y      : 500, 
				width  : constants.PADDLE_WIDTH,
				height : constants.PADDLE_HEIGHT,
				color  : 'white',
				direction: 0
			});
			this.nodes.push({
				id     : 'p2',
				x      : this.canvas.width - constants.MARGIN - constants.PADDLE_WIDTH,
				y      : 500, 
				width  : constants.PADDLE_WIDTH,
				height : constants.PADDLE_HEIGHT,
				color  : 'white',
				direction: 0
			});
			this.nodes.push({
				id     : 'ball',
				x      : this.canvas.width/2,
				y      : this.canvas.height/2,
				width  : 10,
				height : 10,
				color  : 'white',
				directionX: Math.random() < 0.5 ? 1  : -1,
				directionY: Math.random() < 0.5 ? 1  : -1,

			});

		};

		app.onUpdate = function(time){
			p1 = this.getNode('p1');
			p2 = this.getNode('p2');

			function movePlayer(id) { 
				player = app.getNode(id);
				player.y += player.direction * constants.SPEED_MULTIPLIER;
				if (player.y > app.canvas.height - player.height){
					player.y = app.canvas.height - player.height;
				}
				else if (player.y < 0) {
					player.y = 0;
				}
			}
			function moveBall(){
				p1 = app.getNode('p1');
				p2 = app.getNode('p2');
				ball = app.getNode('ball');
				ball.y += ball.directionY * constants.BALL_SPEED;
				ball.x += ball.directionX * constants.BALL_SPEED;
				if (ball.y < 0 ){
					ball.directionY *= - 1;
					ball.y = 1;
				}
				else if (ball.y >  app.canvas.height - ball.height){
					ball.directionY *= - 1;
					ball.y = app.canvas.height - ball.height;
					
				}
				//collision logic. 
				if (
					//check if there's a collision in:
					p1.x < ball.x + ball.width &&   //left
					p1.x + p1.width > ball.x &&     //right
					p1.y < ball.y + ball.height &&  //bottom 
					p1.height + p1.y > ball.y       //top 
					
					|| ( //repeat for the other object
					
					p2.x < ball.x + ball.width &&
					p2.x + p2.width > ball.x &&
					p2.y < ball.y + ball.height &&
					p2.height + p2.y > ball.y
					
					)){
						ball.directionX *= -1; //turn the ball X velocity
					}
					
					else if (ball.x < 0){
						console.log(`player 2 wins. Score: ${app.p1Score}-${++app.p2Score}`);
						app.reset();
					}
					else if (ball.x > app.canvas.width){
						console.log(`player 1 wins Score: ${++app.p1Score}-${app.p2Score}`);
						app.reset();
					}
				}


				movePlayer('p1');
				movePlayer('p2');
				moveBall();
			};
			</script>
				</body>
				</html>