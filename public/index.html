<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas"></canvas>

	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		const constants = {
			SpeedMultiplier: 10,
			BallSpeed: 5,
		}


		app.onInit = function(){
			this.canvas.height = document.documentElement.clientHeight;
			this.canvas.width = document.documentElement.clientWidth;
			p1 = this.getNode('p1');
			p2 = this.getNode('p2');
			document.addEventListener('keydown', event => {

				if (event.code === 'KeyS')      p1.direction =  1;
				if (event.code === 'KeyW')      p1.direction = -1;
				if (event.code === 'ArrowUp')   p2.direction = -1;
				if (event.code === 'ArrowDown') p2.direction =  1;
				if (event.code === 'Space')     app.togglePause();
			});
			document.addEventListener('keyup', event => {
				if (event.code === 'KeyW')      p1.direction = 0;
				if (event.code === 'KeyS')      p1.direction = 0;
				if (event.code === 'ArrowUp')   p2.direction = 0;
				if (event.code === 'ArrowDown') p2.direction = 0;
			})

			this.nodes.push({
				id     : 'background',
				x      : 0,
				y      : 0,
				width  : this.canvas.width,
				height : this.canvas.height,
				color  : 'black'
				})
			this.nodes.push({
				id     : 'p1',
				x      : 10,
				y      : 500, 
				width  : 30,
				height : 250,
				color  : 'white',
				direction: 0
			});
			this.nodes.push({
				id     : 'p2',
				x      : this.canvas.width - 10 - 30,
				y      : 500, 
				width  : 30,
				height : 250,
				color  : 'white',
				direction: 0
			})
			this.nodes.push({
				id     : 'ball',
				x      : this.canvas.width/2,
				y      : this.canvas.height/2,
				width  : 10,
				height : 10,
				color  : 'white',
				directionX: 1,
				directionY: 1,

			})

		};

		app.onUpdate = function(time){

			function movePlayer(id) { 
				player = this.getNode(id);
				player.y += player.direction * constants.SpeedMultiplier;
				if (player.y > this.canvas.height - player.height){
					player.y = this.canvas.height - p2.height;
				}
				else if (player.y < 0) {
					player.y = 0;
				}
			}
			movePlayer('p1');
			movePlayer('p2');
			//moving ball
			ball = this.getNode('ball');
			ball.y += ball.directionY * constants.BallSpeed;
			ball.x += ball.directionX * constants.BallSpeed;
			if (ball.y < 0 ){
				ball.directionY *= - 1;
				ball.y = 1;
			}
			else if (ball.y >  this.canvas.height - ball.height){
				ball.directionY *= - 1;
				ball.y = this.canvas.height - ball.height;

			}
			//collision logic. Looks messy but it only checks if there's overlap.
			if (
				p1.x < ball.x + ball.width &&
        		p1.x + p1.width > ball.x &&
        		p1.y < ball.y + ball.height &&
        		p1.height + p1.y > ball.y 

				|| (

				p2.x < ball.x + ball.width &&
        		p2.x + p2.width > ball.x &&
        		p2.y < ball.y + ball.height &&
        		p2.height + p2.y > ball.y

				)){
					ball.directionX *= -1;
				}
			else if (ball.x < 0){
				console.log(`player 2 wins. Score: ${app.p1Score}-${++app.p2Score}`);
				app.reset();
			}
			else if (ball.x > this.canvas.width){
				console.log(`player 1 wins Score: ${++app.p1Score}-${app.p2Score}`);
				app.reset();
			}
			
		};
	</script>
</body>
</html>