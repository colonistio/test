<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas" width="800" height="400" style="border: solid black;"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript" src="js/playersCommands.js"></script>
	<script type="text/javascript" src="js/collision.js"></script>
	<script type="text/javascript" src="js/startBall.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

		app.onInit = function(){

			/*Values*/
			const canvasTotalWidth = this.canvas.width
			const canvasTotalHeight = this.canvas.height
			const paddleInitialPosition = this.canvas.height/2 - 150/2

			this.nodes.push({
				id : 'red-box',
				x  : startBallPositionAxisX(canvasTotalWidth),
				y  : startBallPositionAxisY(canvasTotalHeight),
				width  : 50,
				height : 50,
				color  : 'red',
				directionX : 3,
				directionY : -3
			});

			this.nodes.push({
				id : 'player-one',
				x  : 0,
				y  : paddleInitialPosition,
				width  : 50,
				height : 150,
				color  : 'black'
			});

			this.nodes.push({
				id : 'player-two',
				x  : canvasTotalWidth - 50,
				y  : paddleInitialPosition,
				width  : 50,
				height : 150,
				color  : 'blue'
			});

			playersMoves = playersMoves.bind(this)
			document.addEventListener('keydown', playersMoves)
		};
		
		app.onUpdate = function(time){

			if(this.getNode("player-one").y < 0){
				this.getNode("player-one").y = 0
			}

			if(this.getNode("player-one").y >= 250){
				this.getNode("player-one").y = 250
			}

			if(this.getNode("player-two").y < 0){
				this.getNode("player-two").y = 0
			}

			if(this.getNode("player-two").y >= 250){
				this.getNode("player-two").y = 250
			}

			/*Ball bouncing logic*/
			this.getNode('red-box').x += this.getNode('red-box').directionX;
			this.getNode('red-box').y += this.getNode('red-box').directionY;
			
			/*Detect collision between player and ball*/
			let player = this.getNode('red-box').x < this.canvas.width / 2 
			? this.getNode('player-one')
			: this.getNode('player-two')

			/*We change the direction based on where the ball hit the paddle*/
			if(collision(this.getNode('red-box'), player)){

				let collidePoint = (this.getNode('red-box').y - (player.y + player.height / 2)) / (player.height/2)
				let angle = collidePoint * (Math.PI / 4)

				let direction = (this.getNode('red-box').x < this.canvas.width / 2 ) ? 1 : -1

				console.log(direction);

				this.getNode('red-box').directionX = direction * 5 * Math.cos(angle)
				this.getNode('red-box').directionY = direction * 5 * Math.sin(angle)
				
			}

			/*Re-directing after hitting a bounce*/
			if(this.getNode('red-box').y + this.getNode('red-box').height > this.canvas.height || this.getNode('red-box').y < 0){
				this.getNode('red-box').directionY = -this.getNode('red-box').directionY;
			}
			if(this.getNode('red-box').x + this.getNode('red-box').width > this.canvas.width || this.getNode('red-box').x < 0){
				this.getNode('red-box').directionX = -this.getNode('red-box').directionX;
			}
		};
	</script>
</body>
</html>